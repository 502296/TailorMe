<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8"/>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>Book an Appointment – TailorMe</title>

  <link rel="stylesheet" href="appointment.css"/>

</head>

<body>

  <main class="tm-wrap">

    <h1 class="tm-title">Book an Appointment</h1>



    <form id="appointmentForm" class="tm-form" novalidate>

      <div class="grid">

        <label><span>Full Name</span>

          <input id="name" name="name" type="text" required/>

        </label>



        <label><span>Email</span>

          <input id="email" name="email" type="email" required/>

        </label>



        <label><span>Phone</span>

          <input id="phone" name="phone" type="tel" inputmode="tel" required/>

        </label>



        <label class="wide"><span>Address</span>

          <input id="address" name="address" type="text" required/>

        </label>



        <label><span>Service Type</span>

          <select id="service" name="service" required>

            <option value="">-- Select --</option>

            <option value="Alteration">Alteration</option>

            <option value="Custom Tailoring">Custom Tailoring</option>

          </select>

        </label>



        <label><span>Number of Pieces</span>

          <input id="pieces" name="pieces" type="number" min="1" required/>

        </label>



        <!-- ملاحظة: أسماء الحقول بأسلوب snake_case لتطابق السكربت -->

        <label><span>Pickup Date</span>

          <input id="pickup_date" name="pickup_date" type="date" required/>

        </label>



        <label><span>Pickup Time</span>

          <input id="pickup_time" name="pickup_time" type="time" required/>

        </label>



        <label><span>Delivery Date</span>

          <input id="delivery_date" name="delivery_date" type="date" required/>

        </label>



        <label><span>Delivery Time</span>

          <input id="delivery_time" name="delivery_time" type="time" required/>

        </label>



        <label class="wide"><span>Additional Notes (optional)</span>

          <textarea id="notes" name="notes" rows="3"></textarea>

        </label>

      </div>



      <button class="tm-btn" type="submit" id="submitBtn">Submit Booking</button>



      <!-- مكان رسالة النجاح/الخطأ -->

      <p id="formMsg" class="tm-msg" role="status" aria-live="polite"></p>

    </form>

  </main>



  <script>

  // رابط Web App (exec)

  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyk1V8RECksbFrHO4tPc8PzVCHXBK9tnx8X4dIJfdXboEK72nGkPGM83XoPsbNkjIG5tw/exec";



  const form = document.getElementById("appointmentForm");

  const msg  = document.getElementById("formMsg");

  const btn  = document.getElementById("submitBtn");

  const val = v => String(v || "").trim();



  form.addEventListener("submit", async (e) => {

    e.preventDefault();



    // رسالة حالة أولية

    msg.style.display = "block";

    msg.style.color = "#9aa4b2";

    msg.textContent = "Sending booking...";



    // جمع الحقول (مطابقة للسكربت)

    const payload = {

      name:        val(form.name.value),

      email:       val(form.email.value),

      phone:       val(form.phone.value),

      address:     val(form.address.value),

      service:     val(form.service.value),

      pieces:      val(form.pieces.value),

      pickup_date: form.pickup_date.value,

      pickup_time: form.pickup_time.value,

      delivery_date: form.delivery_date.value,

      delivery_time: form.delivery_time.value,

      notes:       val(form.notes.value),

      source:      location.href

    };



    // تحقّق سريع

    for (const k of ['name','email','phone','address','service','pieces','pickup_date','pickup_time','delivery_date','delivery_time']){

      if(!payload[k]){ msg.textContent = "Please fill all required fields."; return; }

    }

    if (!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(payload.email)){

      msg.textContent = "Please enter a valid email."; return;

    }



    btn.disabled = true; btn.textContent = "Submitting...";



    try {

      // نرسل كنص عادي + no-cors لتجنب أي CORS preflight

      await fetch(WEB_APP_URL, {

        method: "POST",

        mode: "no-cors",

        headers: { "Content-Type": "text/plain;charset=utf-8" },

        body: JSON.stringify(payload)

      });



      // نعرض رسالة نجاح خضراء

      msg.textContent = "✅ Booking confirmed! Thank you for choosing TailorMe.";

      msg.style.color = "#28a745";

      msg.style.background = "rgba(40,167,69,0.1)";

      msg.style.padding = "10px";

      msg.style.borderRadius = "8px";



      form.reset();



      // إخفاء الرسالة بعد 5 ثوانٍ (اختياري)

      setTimeout(() => { msg.style.display = "none"; }, 5000);



    } catch (err) {

      console.error(err);

      msg.textContent = "❌ Something went wrong. Please try again.";

      msg.style.color = "red";

    } finally {

      btn.disabled = false; btn.textContent = "Submit Booking";

    }

  });

  </script>

</body>

</html>
