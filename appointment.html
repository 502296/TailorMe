<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8"/>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>Book an Appointment – TailorMe</title>

  <link rel="stylesheet" href="appointment.css"/>

</head>

<body>

  <main class="tm-wrap">

    <h1 class="tm-title">Book an Appointment</h1>



    <form id="appointmentForm" class="tm-form" novalidate>

      <div class="grid">

        <label><span>Full Name</span>

          <input id="name" name="name" type="text" required/>

        </label>



        <label><span>Email</span>

          <input id="email" name="email" type="email" required/>

        </label>



        <label><span>Phone</span>

          <input id="phone" name="phone" type="tel" inputmode="tel" required/>

        </label>



        <label class="wide"><span>Address</span>

          <input id="address" name="address" type="text" required/>

        </label>



        <label><span>Service Type</span>

          <select id="service" name="service" required>

            <option value="">-- Select --</option>

            <option value="Alteration">Alteration</option>

            <option value="Custom Tailoring">Custom Tailoring</option>

          </select>

        </label>



        <label><span>Number of Pieces</span>

          <input id="pieces" name="pieces" type="number" min="1" required/>

        </label>



        <!-- انتبه: الأسماء بأسلوب snake_case كما يتوقع السكربت -->

        <label><span>Pickup Date</span>

          <input id="pickup_date" name="pickup_date" type="date" required/>

        </label>



        <label><span>Pickup Time</span>

          <input id="pickup_time" name="pickup_time" type="time" required/>

        </label>



        <label><span>Delivery Date</span>

          <input id="delivery_date" name="delivery_date" type="date" required/>

        </label>



        <label><span>Delivery Time</span>

          <input id="delivery_time" name="delivery_time" type="time" required/>

        </label>



        <label class="wide"><span>Additional Notes (optional)</span>

          <textarea id="notes" name="notes" rows="3"></textarea>

        </label>

      </div>



      <button class="tm-btn" type="submit" id="submitBtn">Submit Booking</button>

      <p id="formMsg" class="tm-msg" role="status" aria-live="polite"></p>

    </form>

  </main>



  <script>

  // رابط الويب آب تبعك:

  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyk1V8RECksbFrHO4tPc8PzVCHXBK9tnx8X4dIJfdXboEK72nGkPGM83XoPsbNkjIG5tw/exec";



  const form = document.getElementById('appointmentForm');

  const msg  = document.getElementById('formMsg');

  const btn  = document.getElementById('submitBtn');

  const val = v => String(v || '').trim();



  form.addEventListener('submit', async (e) => {

    e.preventDefault();

    msg.textContent = "";



    const payload = {

      name: val(form.name.value),

      email: val(form.email.value),

      phone: val(form.phone.value),

      address: val(form.address.value),

      service: val(form.service.value),

      pieces: val(form.pieces.value),

      pickup_date: form.pickup_date.value,

      pickup_time: form.pickup_time.value,

      delivery_date: form.delivery_date.value,

      delivery_time: form.delivery_time.value,

      notes: val(form.notes.value),

      source: location.href

    };



    // تحقق سريع للإلزاميات

    for (const k of ['name','email','phone','address','service','pieces','pickup_date','pickup_time','delivery_date','delivery_time']){

      if(!payload[k]){ msg.textContent = "Please fill all required fields."; return; }

    }

    if (!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(payload.email)){

      msg.textContent = "Please enter a valid email."; return;

    }



    btn.disabled = true; btn.textContent = "Submitting...";



    try {

      // نرسل كـ text/plain لتجنب CORS preflight

      const res = await fetch(WEB_APP_URL, {

        method: "POST",

        headers: { "Content-Type": "text/plain;charset=utf-8" },

        body: JSON.stringify(payload)

      });



      let ok = false;

      try { const data = await res.json(); ok = !!data.ok; } catch(_) { ok = res.ok; }



      if (ok) {

        msg.textContent = "✅ Booking received! A confirmation email has been sent.";

        form.reset();

      } else {

        msg.textContent = "⚠️ Submitted, but something looked off. We’ll confirm shortly.";

      }

    } catch (err) {

      console.error(err);

      msg.textContent = "❌ Network error. Please try again.";

    } finally {

      btn.disabled = false; btn.textContent = "Submit Booking";

    }

  });

  </script>

</body>

</html>
