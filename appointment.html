<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>Book an Appointment â€“ TailorMe</title>

  <link rel="stylesheet" href="appointment.css" />

</head>

<body>

  <header class="tm-header">

    <div class="tm-brand">

      <span class="tm-logo">ğŸ‘‘</span>

      <span class="tm-name">TailorMe</span>

    </div>

  </header>



  <main class="tm-main">

    <section class="tm-card">

      <h1 class="tm-title">Book an Appointment</h1>

      <p class="tm-subtitle">Mobile Alterations & Custom Tailoring</p>



      <form id="appointmentForm" novalidate>

        <div class="grid">

          <label class="field">

            <span>Name</span>

            <input type="text" id="name" name="name" required />

          </label>



          <label class="field">

            <span>Email</span>

            <input type="email" id="email" name="email" required inputmode="email" autocomplete="email"

                   pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$" />

          </label>



          <label class="field">

            <span>Phone</span>

            <input type="tel" id="phone" name="phone" required />

          </label>



          <label class="field full">

            <span>Address</span>

            <input type="text" id="address" name="address" required />

          </label>



          <label class="field">

            <span>Service Type</span>

            <select id="service" name="service" required>

              <option value="">-- Select --</option>

              <option value="Alteration">Alteration</option>

              <option value="Custom">Custom</option>

            </select>

          </label>



          <label class="field">

            <span>Number of Pieces</span>

            <input type="number" min="1" id="pieces" name="pieces" required />

          </label>



          <label class="field">

            <span>Pickup Date</span>

            <input type="date" id="pickup_date" name="pickup_date" required />

          </label>



          <label class="field">

            <span>Pickup Time</span>

            <input type="time" id="pickup_time" name="pickup_time" required />

          </label>



          <label class="field full">

            <span>Additional Notes (optional)</span>

            <textarea id="notes" name="notes" rows="3" placeholder="Any special instructions..."></textarea>

          </label>

        </div>



        <button class="tm-btn" id="submitBtn" type="submit">Submit Booking</button>

        <p id="status" class="status" role="status" aria-live="polite"></p>

      </form>

    </section>

  </main>



  <footer class="tm-footer">

    <small>Â© <span id="year"></span> TailorMe â€” Louisville, KY</small>

  </footer>



  <script>

    // ===== Web App URL (Ø¬Ø§Ù‡Ø²) =====

    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwCoG_JRmDASWhnrFX0f98rMWUOIbKVzs6eyCBkNU_t7YAuQVmRfoPdNqPqfvL1EEm4/exec';



    const $ = sel => document.querySelector(sel);

    document.getElementById('year').textContent = new Date().getFullYear();



    const form = $('#appointmentForm');

    const statusEl = $('#status');

    const submitBtn = $('#submitBtn');



    function showStatus(msg, ok = true){

      statusEl.textContent = msg;

      statusEl.style.color = ok ? '#c1ffd6' : '#ffb3b3';

    }



    form.addEventListener('submit', async (e) => {

      e.preventDefault();

      showStatus('Submittingâ€¦');

      submitBtn.disabled = true;



      const payload = {

        name: $('#name').value.trim(),

        email: $('#email').value.trim(),

        phone: $('#phone').value.trim(),

        address: $('#address').value.trim(),

        service: $('#service').value,

        pieces: $('#pieces').value.trim(),

        pickup_date: $('#pickup_date').value,

        pickup_time: $('#pickup_time').value,

        notes: $('#notes').value.trim()

      };



      // ØªØ­Ù‚Ù‚ Ø³Ø±ÙŠØ¹

      const required = ['name','email','phone','address','service','pieces','pickup_date','pickup_time'];

      for (const k of required){ if(!payload[k]){ showStatus('Please fill all required fields.', false); submitBtn.disabled = false; return; } }

      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(payload.email)) { showStatus('Please enter a valid email address.', false); submitBtn.disabled = false; return; }



      // Ù…Ø­Ø§ÙˆÙ„Ø© 1: Ø·Ù„Ø¨ Ø¹Ø§Ø¯ÙŠ

      try {

        const res = await fetch(WEB_APP_URL, {

          method: 'POST',

          headers: { 'Content-Type': 'application/json' },

          body: JSON.stringify(payload)

        });

        if (!res.ok) throw new Error('HTTP ' + res.status);

        const data = await res.json();

        if (data && data.ok) {

          window.location.href = 'thank-you.html';

          return;

        }

        throw new Error('Unexpected response');

      } catch (err) {

        // Ù…Ø­Ø§ÙˆÙ„Ø© 2: no-cors (ØªÙˆØ§ÙÙ‚)â€”Ù„Ù† Ù†Ù‚Ø±Ø£ Ø§Ù„Ø±Ø¯ØŒ Ù„ÙƒÙ† Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙŠØ³ØªÙ‚Ø¨Ù„ ÙˆÙŠØ­ÙØ¸ ÙˆÙŠØ±Ø³Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„

        try {

          await fetch(WEB_APP_URL, {

            method: 'POST',

            mode: 'no-cors',

            headers: { 'Content-Type': 'application/json' },

            body: JSON.stringify(payload)

          });

          window.location.href = 'thank-you.html';

        } catch (e2) {

          showStatus('âŒ Could not submit. Re-check Web App access (Anyone) and re-deploy, then try again.', false);

          submitBtn.disabled = false;

        }

      }

    });

  </script>

</body>

</html>
