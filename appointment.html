<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>Book an Appointment – TailorMe</title>

  <link rel="stylesheet" href="appointment.css" />

  <style>

    html, body { overflow-x: hidden; }

    * { box-sizing: border-box; }

    img, video, canvas, svg { max-width: 100%; height: auto; display: block; }

    .form-status { margin-top:.5rem; font-size:.95rem }

    .form-status.ok { color:#9fe3a1 }

    .form-status.err { color:#ffb3b3 }

    .btn-primary[data-busy="1"]{ opacity:.75; pointer-events:none }

    .success-card{ display:none }

  </style>

</head>



<body>

  <!-- Header -->

  <header class="tm-header">

    <div class="brand">

      <img src="images/logo.png" alt="TailorMe Logo" class="brand-logo" />

      <span class="brand-name">TailorMe</span>

    </div>

  </header>



  <!-- Form -->

  <main class="form-wrap">

    <h1 class="form-title">Book an Appointment (Pickup)</h1>



    <form id="appointmentForm" novalidate>

      <div class="field">

        <label for="email">Email <span>*</span></label>

        <input type="email" id="email" name="email" placeholder="you@example.com" required />

      </div>



      <div class="field">

        <label for="name">Full Name <span>*</span></label>

        <input type="text" id="name" name="name" placeholder="John Doe" required />

      </div>



      <div class="field">

        <label for="phone">Phone <span>*</span></label>

        <input type="tel" id="phone" name="phone" placeholder="(502) 123-4567" required />

      </div>



      <div class="field">

        <label for="address">Address <span>*</span></label>

        <input type="text" id="address" name="address" placeholder="123 Main St, Louisville, KY" required />

      </div>



      <div class="field">

        <label for="service">Service Type <span>*</span></label>

        <select id="service" name="service" required>

          <option value="">— Select —</option>

          <option value="Alteration">Alteration</option>

          <option value="Custom">Custom</option>

        </select>

      </div>



      <div class="field">

        <label for="pieces">Number of Pieces <span>*</span></label>

        <input type="number" id="pieces" name="pieces" min="1" step="1" placeholder="1" required />

      </div>



      <div class="field two-col">

        <div>

          <label for="pickup_date">Pickup Date <span>*</span></label>

          <input type="date" id="pickup_date" name="pickup_date" required />

        </div>

        <div>

          <label for="pickup_time">Pickup Time <span>*</span></label>

          <input type="time" id="pickup_time" name="pickup_time" required />

        </div>

      </div>



      <div class="field">

        <label for="notes">Additional Notes (optional)</label>

        <textarea id="notes" name="notes" rows="3" placeholder="E.g., hem 2cm, taper legs..."></textarea>

      </div>



      <button id="submitBtn" type="submit" class="btn-primary">Submit Booking</button>

      <p id="formStatus" class="form-status" aria-live="polite"></p>

    </form>

  </main>



  <!-- Success card -->

  <section id="successCard" class="success-card" aria-live="polite">

    <div class="success-inner">

      <div class="success-icon">✅</div>

      <div>

        <h3 class="success-title">Thank you! Your booking was received.</h3>

        <p class="success-text">We emailed a confirmation to you. We'll follow up shortly to confirm the pickup window.</p>

      </div>

    </div>

  </section>



  <!-- Footer -->

  <footer class="tm-footer">

    <p>© <span id="year"></span> TailorMe — Mobile Alterations & Custom Tailoring</p>

  </footer>



  <!-- Script -->

  <script>

    // Web App URL (Google Apps Script)

    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzYLH7nmp7PzzLbakf7ILStPfIX1t_EpSK6PcU619orLg2kasmwcMW_-ydHwnm-CP6P5Q/exec';



    // Year in footer

    document.getElementById('year').textContent = new Date().getFullYear();



    // Min pickup date = today (UX فقط)

    (function setMinPickupDate(){

      const d=new Date(), y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), day=String(d.getDate()).padStart(2,'0');

      const pd=document.getElementById('pickup_date'); if(pd) pd.min=`${y}-${m}-${day}`;

    })();



    const form = document.getElementById('appointmentForm');

    const statusEl = document.getElementById('formStatus');

    const submitBtn = document.getElementById('submitBtn');

    const successCard = document.getElementById('successCard');



    // Honeypot مضاد سبام

    const hp = document.createElement('input');

    hp.type = 'text'; hp.name = 'company'; hp.style.position='absolute'; hp.style.left='-10000px'; hp.tabIndex=-1;

    form.appendChild(hp);



    function setStatus(msg, ok = true) {

      statusEl.textContent = msg;

      statusEl.className = 'form-status ' + (ok ? 'ok' : 'err');

    }

    function setBusy(b){

      submitBtn.disabled = b;

      submitBtn.dataset.busy = b ? '1' : '0';

      submitBtn.textContent = b ? 'Submitting…' : 'Submit Booking';

    }



    async function postAsTextPlain_(payload) {

      return fetch(WEB_APP_URL, {

        method: 'POST',

        mode: 'no-cors',

        headers: { 'Content-Type': 'text/plain;charset=utf-8' },

        body: JSON.stringify(payload)

      });

    }

    async function postAsForm_(payload) {

      const params = new URLSearchParams(payload);

      return fetch(WEB_APP_URL, {

        method: 'POST',

        mode: 'no-cors',

        headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8' },

        body: params.toString()

      });

    }



    function buildPayload(){

      const pdate = form.pickup_date.value;

      const ptime = form.pickup_time.value;

      const pickup_iso = (pdate && ptime) ? `${pdate}T${ptime}:00` : '';

      return {

        email: form.email.value.trim(),

        name: form.name.value.trim(),

        phone: form.phone.value.trim(),

        address: form.address.value.trim(),

        service: form.service.value,

        pieces: form.pieces.value,

        pickup_date: pdate,

        pickup_time: ptime,

        pickup_iso,

        notes: form.notes.value.trim(),

        userAgent: navigator.userAgent

      };

    }



    form.addEventListener('submit', async (e) => {

      e.preventDefault();



      // لو البوت عبّى الحقل المخفي: نجاح صامت

      if (hp.value) {

        form.reset();

        setStatus('Thank you! Your booking was received.');

        successCard.style.display = 'block';

        return;

      }



      if (!form.checkValidity()) {

        setStatus('Please fill all required fields correctly.', false);

        return;

      }



      setBusy(true);

      setStatus('Submitting… please wait.');



      const payload = buildPayload();



      try {

        await postAsTextPlain_(payload);

        // Retry احتياطي بصيغة form-encoded

        setTimeout(() => postAsForm_(payload).catch(()=>{}), 600);



        setStatus('Thank you! Your booking was received. A confirmation will be emailed to you shortly.');

        form.reset();

        successCard.style.display = 'block';

        successCard.scrollIntoView({ behavior: 'smooth' });

      } catch (err) {

        console.error(err);

        setStatus('Submission failed. Please try again or contact us at contact@tailorme.me.', false);

      } finally {

        setBusy(false);

      }

    });

  </script>

</body>

</html>
